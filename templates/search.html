{% extends 'base.html' %}

{% block content %}
  <h2>Search Candidates</h2>

  {# Corrected Search Form: changed method to GET, input name to 'query' #}
  <form method="get" action="{{ url_for('search') }}" class="search-form">
    <input type="text" name="query" placeholder="Search by name, email, phone, or skill..." value="{{ search_query if search_query }}"> {# Use search_query here #}
    <button type="submit">Search</button>
    {% if search_query %} {# Show a clear button only if a search was performed #}
        <a href="{{ url_for('search') }}" class="btn btn-secondary clear-search-btn">Clear Search</a>
    {% endif %}
  </form>

  {# Display Messages based on search_query and resumes list #}
  {% if search_query and not resumes %} {# A search was performed, but no results found #}
    <p class="info-message">No candidates found matching your search criteria: "<strong>{{ search_query }}</strong>".</p>
  {% elif not search_query and not resumes %} {# No search performed, and no resumes in DB #}
    <p class="info-message">No candidates available. Upload a resume to get started.</p>
  {% endif %}

  {# Display Table if there are resumes #}
  {% if resumes %} {# Use 'resumes' instead of 'results' #}
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Skills</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for resume in resumes %} {# Loop through 'resumes' #}
          <tr>
            <td>{{ resume.name }}</td>
            <td>{{ resume.email }}</td>
            <td>{{ resume.phone }}</td>
            <td>{{ resume.skills }}</td>
            <td>
              <div class="action-buttons">
                {# Assuming view_resume exists for a detailed view #}
                <a href="{{ url_for('view_resume', resume_id=resume.id) }}" class="btn btn-sm">View</a>
                <a href="{{ url_for('edit_resume', resume_id=resume.id) }}" class="btn btn-secondary btn-sm">Edit</a>
                <form method="post" action="{{ url_for('delete_resume', resume_id=resume.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this candidate?');">
                  <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
              </div>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
{% endblock %}